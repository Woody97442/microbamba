import{r as n,j as e,H as p,a as b,I as g,F as w,b as y,c as v}from"./index-HDASJAGO.js";const E=()=>{const[f,o]=n.useState(!1);let[d,h]=n.useState(0),[a,x]=n.useState(()=>{const s=localStorage.getItem("cart");return s?JSON.parse(s):[]});n.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(a))},[a]);const[i,j]=n.useState([]);n.useEffect(()=>{N()},[i]),n.useEffect(()=>{(async()=>{const t=await Promise.all(a.map(async l=>({...await y(l.productId),quantity:l.quantity})));j(t),o(!1)})()},[a]);const m=(s,t,l)=>{const r=a.findIndex(c=>c.productId===t);if(r!==-1){const c=[...a];l==="increment"?c[r].quantity=s+1:l==="decrement"&&(s===1?c.splice(r,1):c[r].quantity=s-1),x(c)}else l==="increment"&&x([...a,{productId:t,quantity:s+1}])},N=()=>{let s=0;for(let t=0;t<i.length;t++){const l=i[t];l&&a[t]&&(s+=parseFloat(l.price)*a[t].quantity)}h(s)},u=async s=>{o(!0);try{await v(s),console.log("Commande effectuée avec succès !"),x([]),localStorage.removeItem("cart"),o(!1)}catch(t){console.error("Erreur lors de la commande :",t),o(!1)}};return e.jsxs("div",{className:"flex flex-col justify-between min-h-screen",children:[e.jsx("div",{children:e.jsx(p,{})}),e.jsxs("main",{className:"px-[10px] lg:px-[30px] xl:px-[200px] mb-5 flex flex-row gap-4 mt-10",children:[e.jsxs("section",{className:"flex flex-col gap-5 w-full",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-primary text-start text-[#191E8F]",children:"Produits dans votre panier"}),e.jsx("h2",{className:"text-lg font-bold font-secondary",children:"ACHATS EN COURS"})]}),i.map((s,t)=>e.jsxs("div",{className:"bg-white p-4 gap-4 flex flex-row",children:[e.jsx("a",{href:`/microbamba/product/${s.id}`,children:e.jsx("img",{src:s.imageUrl,alt:s.imageAlt,className:"w-[100px] object-cover"})}),e.jsxs("div",{className:"flex flex-col gap-4  w-full",children:[e.jsxs("div",{className:"flex flex-row  justify-between",children:[e.jsx("h1",{className:"text-2xl font-primary",children:s.title}),e.jsxs("p",{className:"text-lg font-bold",children:["Console :"," ",e.jsx("span",{className:"font-normal",children:s.console})]})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"text-lg font-bold",children:["Prix : ",s.price,"€"]}),e.jsxs("div",{className:"flex flex-row gap-2  w-fit my-5",children:[e.jsx("button",{className:"btn btn-secondary text-white btn-xs",onClick:()=>{m(s.quantity,s._id,"decrement")},children:e.jsx(b,{className:"w-5 h-5"})}),e.jsx("span",{className:"text-xl font-bold w-5 h-5 items-center text-center",children:s.quantity}),e.jsx("button",{className:"btn btn-secondary text-white btn-xs ",onClick:()=>{m(s.quantity,s._id,"increment")},children:e.jsx(g,{className:"w-5 h-5"})})]})]})]})]},t))]}),e.jsxs("section",{className:"flex flex-col gap-5 w-1/2",children:[e.jsx("h1",{className:"text-2xl font-primary text-center text-[#191E8F]",children:"En résumé"}),e.jsxs("form",{className:"bg-white p-4 gap-4 flex flex-col",children:[e.jsx("h2",{className:"text-lg font-bold font-secondary",children:"MONTANT PANIER :"}),i.map((s,t)=>e.jsxs("div",{className:"flex flex-row mx-4 gap-4",children:[e.jsx("img",{src:s.imageUrl,alt:s.imageAlt,className:"w-[64px] h-auto object-cover"}),e.jsx("div",{className:"flex flex-col w-full justify-between",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-md text-secondary font-primary",children:s.title}),e.jsxs("span",{className:"font-bold text-md ",children:["Prix unité : ",s.price,"€"]}),e.jsxs("span",{className:"font-bold text-md ",children:["Total :"," ",(parseFloat(s.price)*s.quantity).toFixed(2),"€"]})]})})]},t)),e.jsx("div",{className:"divider mt-1 "}),e.jsxs("h2",{className:"text-lg font-bold font-secondary",children:["TOTAL : ",d.toFixed(2),"€"]}),e.jsx("div",{className:"divider mt-1 "}),f?e.jsx("button",{className:"btn btn-secondary text-white w-full",type:"submit",disabled:!0,children:e.jsx("span",{className:"loading loading-infinity loading-lg"})}):e.jsx("button",{className:"btn btn-secondary text-white w-full",onClick:()=>u(d.toFixed(2)),children:"Commander"})]})]})]}),e.jsx(w,{})]})};export{E as default};
